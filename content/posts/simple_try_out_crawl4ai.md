---
title: "å¿«é€Ÿä½“éªŒè¿‘æœŸæœ€ç«çš„AIçˆ¬è™«é¡¹ç›®-Crawl4AI"
date: 2024-10-17T23:02:15+08:00
draft: false
---

[Crawl4AI](https://github.com/unclecode/crawl4ai)åº”è¯¥æ˜¯è¿‘æœŸæœ€ç«çš„ AI çˆ¬è™«é¡¹ç›®äº†ã€‚

è¿™ä¸ªé¡¹ç›®å¸å¼•æˆ‘çš„ç‚¹æœ‰ 2 ä¸ªï¼š

- å¼•å…¥äº† AI
- åº•å±‚ä½¿ç”¨çš„æ˜¯[playwright](https://playwright.dev/)

## æ ¸å¿ƒç‰¹æ€§

å®˜æ–¹çš„ä»‹ç»æ˜¯è¿™æ ·çš„ã€‚

- ğŸ†“ å®Œå…¨å…è´¹å’Œå¼€æº
- ğŸš€ æ€§èƒ½æå¿«ï¼Œè¶…è¶Šè®¸å¤šä»˜è´¹æœåŠ¡
- ğŸ¤– é€‚åˆå¤§è¯­è¨€æ¨¡å‹çš„è¾“å‡ºæ ¼å¼ï¼ˆJSONã€æ¸…ç†è¿‡çš„ HTMLã€markdownï¼‰
- ğŸŒ æ”¯æŒåŒæ—¶çˆ¬å–å¤šä¸ª URL
- ğŸ¨ æå–å¹¶è¿”å›æ‰€æœ‰åª’ä½“æ ‡ç­¾ï¼ˆå›¾ç‰‡ã€éŸ³é¢‘å’Œè§†é¢‘ï¼‰
- ğŸ”— æå–æ‰€æœ‰å¤–éƒ¨å’Œå†…éƒ¨é“¾æ¥
- ğŸ“š ä»é¡µé¢æå–å…ƒæ•°æ®
- ğŸ”„ ç”¨äºèº«ä»½éªŒè¯ã€å¤´éƒ¨å’Œçˆ¬å–å‰é¡µé¢ä¿®æ”¹çš„è‡ªå®šä¹‰é’©å­
- ğŸ•µï¸ ç”¨æˆ·ä»£ç†è‡ªå®šä¹‰
- ğŸ–¼ï¸ å¯¹é¡µé¢è¿›è¡Œæˆªå›¾
- ğŸ“œ çˆ¬å–å‰æ‰§è¡Œå¤šä¸ªè‡ªå®šä¹‰ JavaScript
- ğŸ“Š ä½¿ç”¨ JsonCssExtractionStrategy ç”Ÿæˆç»“æ„åŒ–è¾“å‡ºï¼Œæ— éœ€å¤§è¯­è¨€æ¨¡å‹
- ğŸ“š å¤šç§åˆ‡ç‰‡ç­–ç•¥ï¼šåŸºäºä¸»é¢˜ã€æ­£åˆ™è¡¨è¾¾å¼ã€å¥å­ç­‰
- ğŸ§  é«˜çº§æå–ç­–ç•¥ï¼šä½™å¼¦èšç±»ã€å¤§è¯­è¨€æ¨¡å‹ç­‰
- ğŸ¯ æ”¯æŒ CSS é€‰æ‹©å™¨ä»¥ç²¾ç¡®æå–æ•°æ®
- ğŸ“ ä¼ é€’æŒ‡ä»¤/å…³é”®è¯ä»¥ä¼˜åŒ–æå–
- ğŸ”’ æ”¯æŒä»£ç†ä»¥å¢å¼ºéšç§å’Œè®¿é—®
- ğŸ”„ ä¼šè¯ç®¡ç†ï¼Œé€‚ç”¨äºå¤æ‚çš„å¤šé¡µé¢çˆ¬å–åœºæ™¯
- ğŸŒ å¼‚æ­¥æ¶æ„ï¼Œæé«˜æ€§èƒ½å’Œå¯æ‰©å±•æ€§

ç”¨çš„ä¸€æ‰‹å¥½ emojiğŸ‘ã€‚

è¿™é‡Œé¢ä¸€äº›ä¼ ç»Ÿçˆ¬è™«æ‰€ä¸æ”¯æŒçš„åŠŸèƒ½åŸºæœ¬ä¸Šæ¥è‡ªäº playwrightï¼Œæ¯”å¦‚æˆªå›¾ä¹‹ç±»çš„ã€‚

æ¯”è¾ƒæœ‰æ„æ€æ˜¯å¼•å…¥äº†åˆ‡ç‰‡ç­–ç•¥å’Œä½¿ç”¨å¤§é¢„è¨€æ¨¡å‹æ¥å¤„ç†çˆ¬å–çš„å†…å®¹ã€‚

## å®‰è£…

Crawl4AI çš„å®‰è£…ç›¸å¯¹æ¯”è¾ƒå¤æ‚ï¼Œä¸è¿‡å¦‚æœä¸éœ€è¦æ·±å…¥ä½“éªŒæœ¬åœ°å¤§æ¨¡å‹çš„è¯ï¼Œä½¿ç”¨æœ€åŸºæœ¬çš„å®‰è£…æ–¹å¼å°±å¯ä»¥äº†ã€‚

åŸºæœ¬ä¸Šæ˜¯ 2 æ¡å‘½ä»¤ã€‚

```
pip install crawl4ai
python -m playwright install chromium
```

è¿™é‡Œä¸ºäº†èŠ‚çº¦æ—¶é—´å’Œç©ºé—´ï¼Œåªå®‰è£…äº† playwright çš„ chrome æµè§ˆå™¨ï¼Œä¸€èˆ¬æƒ…å†µä¸‹å¤Ÿç”¨äº†ã€‚

## çˆ¬è±†ç“£ä¸Šè¯„åˆ†æœ€é«˜çš„ 250 æœ¬ä¹¦

å†™äº†ä¸ªè·å–è±†ç“£è¯„åˆ†æœ€é«˜çš„ 250 æœ¬å›¾ä¹¦çš„çˆ¬è™«ã€‚

è¿™ä¸ªçˆ¬è™«è·Ÿå¤§è¯­è¨€æ¨¡å‹æ²¡æœ‰åŠæ¯›é’±å…³ç³»ã€‚

å¤§æ¦‚çš„è¿‡ç¨‹å°±æ˜¯è®¿é—®https://book.douban.com/top250è¿™ä¸ªé¡µé¢ä»¥åŠåé¢çš„9ä¸ªåˆ†é¡µï¼ŒæŠŠæ¯ä¸€é¡µçš„25æœ¬å›¾ä¹¦éƒ½çˆ¬ä¸‹æ¥ã€‚

æ‹¿å®˜æ–¹çš„ä¾‹å­éšæ‰‹æ”¹äº†æ”¹ï¼Œä»£ç å¦‚ä¸‹ã€‚

```python
import asyncio
import json
from crawl4ai import AsyncWebCrawler
from crawl4ai.extraction_strategy import JsonCssExtractionStrategy
from pprint import pprint as pp

async def extract_books():
    schema = {
        "name": "Douban Book 250",
        "baseSelector": "tr.item",
        "type": "list",
        "fields": [
            {
                "name": "title",
                "type": "text",
                "selector": ".pl2 > a",
            },
            {
                "name": "url",
                "type": "attribute",
                "selector": ".pl2 > a",
                "attribute": "href",
            },
            {
                "name": "info",
                "type": "text",
                "selector": ".pl",
            },
            {
                "name": "rate",
                "type": "text",
                "selector": ".rating_nums",
            },
            {
                "name": "quote",
                "type": "text",
                "selector": "span.inq",
            },
        ],
    }

    extraction_strategy = JsonCssExtractionStrategy(schema, verbose=True)

    async with AsyncWebCrawler(verbose=True) as crawler:
        for i in range(10):
            result = await crawler.arun(
                url = f"https://book.douban.com/top250?start={i * 25}",
                extraction_strategy=extraction_strategy,
                bypass_cache=True,
            )
            assert result.success, "Failed to crawl the page"

            books = json.loads(result.extracted_content)
            pp(books)
            print(f"Successfully extracted {len(books)} books")

if __name__ == "__main__":
    asyncio.run(extract_books())
```

éƒ¨åˆ†ç»“æœå¦‚ä¸‹

```
[{'info': '[æ¸…] æ›¹é›ªèŠ¹ è‘— / äººæ°‘æ–‡å­¦å‡ºç‰ˆç¤¾ / 1996-12 / 59.70å…ƒ',
  'quote': 'éƒ½äº‘ä½œè€…ç—´ï¼Œè°è§£å…¶ä¸­å‘³ï¼Ÿ',
  'rate': '9.6',
  'title': 'çº¢æ¥¼æ¢¦',
  'url': 'https://book.douban.com/subject/1007305/'},
 {'info': 'ä½™å / ä½œå®¶å‡ºç‰ˆç¤¾ / 2012-8 / 20.00å…ƒ',
  'quote': 'ç”Ÿçš„è‹¦éš¾ä¸ä¼Ÿå¤§',
  'rate': '9.4',
  'title': 'æ´»ç€',
  'url': 'https://book.douban.com/subject/4913064/'},
 {'info': '[è‹±] ä¹”æ²»Â·å¥¥å¨å°” / åˆ˜ç»é“­ / åŒ—äº¬åæœˆæ–‡è‰ºå‡ºç‰ˆç¤¾ / 2010-4-1 / 28.00',
  'quote': 'æ —æ ‘è«ä¸‹ï¼Œæˆ‘å‡ºå–ä½ ï¼Œä½ å‡ºå–æˆ‘',
  'rate': '9.4',
  'title': '1984',
  'url': 'https://book.douban.com/subject/4820710/'},
 {'info': 'J.K.ç½—ç³ (J.K.Rowling) / è‹å†œ / äººæ°‘æ–‡å­¦å‡ºç‰ˆç¤¾ / 2008-12-1 / 498.00å…ƒ',
  'quote': 'ä»9Â¾ç«™å°å¼€å§‹çš„æ—…ç¨‹',
  'rate': '9.7',
  'title': 'å“ˆåˆ©Â·æ³¢ç‰¹',
  'url': 'https://book.douban.com/subject/24531956/'},
 {'info': 'åˆ˜æ…ˆæ¬£ / é‡åº†å‡ºç‰ˆç¤¾ / 2012-1 / 168.00å…ƒ',
  'quote': 'åœ°çƒå¾€äº‹ä¸‰éƒ¨æ›²',
  'rate': '9.5',
  'title': 'ä¸‰ä½“å…¨é›†: åœ°çƒå¾€äº‹ä¸‰éƒ¨æ›²',
  'url': 'https://book.douban.com/subject/6518605/'},
 {'info': '[å“¥ä¼¦æ¯”äºš] åŠ è¥¿äºšÂ·é©¬å°”å…‹æ–¯ / èŒƒæ™” / å—æµ·å‡ºç‰ˆå…¬å¸ / 2011-6 / 39.50å…ƒ',
  'quote': 'é­”å¹»ç°å®ä¸»ä¹‰æ–‡å­¦ä»£è¡¨ä½œ',
  'rate': '9.3',
  'title': 'ç™¾å¹´å­¤ç‹¬',
  'url': 'https://book.douban.com/subject/6082808/'},
 {'info': '[ç¾å›½] ç›æ ¼ä¸½ç‰¹Â·ç±³åˆ‡å°” / æç¾å / è¯‘æ—å‡ºç‰ˆç¤¾ / 2000-9 / 40.00å…ƒ',
  'quote': 'é©å‘½æ—¶æœŸçš„çˆ±æƒ…ï¼Œéšé£è€Œé€',
  'rate': '9.3',
  'title': 'é£˜',
  'url': 'https://book.douban.com/subject/1068920/'},
 {'info': '[è‹±] ä¹”æ²»Â·å¥¥å¨å°” / è£å¦‚å¾· / ä¸Šæµ·è¯‘æ–‡å‡ºç‰ˆç¤¾ / 2007-3 / 10.00å…ƒ',
  'quote': 'å¤ªé˜³åº•ä¸‹å¹¶æ— æ–°äº‹',
  'rate': '9.3',
  'title': 'åŠ¨ç‰©å†œåœº',
  'url': 'https://book.douban.com/subject/2035179/'},
 {'info': 'æ—å¥•å« / åŒ—äº¬è”åˆå‡ºç‰ˆå…¬å¸ / 2018-2 / 45.00å…ƒ',
  'quote': 'å‘æ­»è€Œç”Ÿçš„æ–‡å­¦ç»å”±',
  'rate': '9.2',
  'title': 'æˆ¿æ€çªçš„åˆæ‹ä¹å›­',
  'url': 'https://book.douban.com/subject/27614904/'},
 {'info': '[æ˜] ç½—è´¯ä¸­ / äººæ°‘æ–‡å­¦å‡ºç‰ˆç¤¾ / 1998-05 / 39.50å…ƒ',
  'quote': 'æ˜¯éæˆè´¥è½¬å¤´ç©º',
  'rate': '9.3',
  'title': 'ä¸‰å›½æ¼”ä¹‰ï¼ˆå…¨äºŒå†Œï¼‰',
  'url': 'https://book.douban.com/subject/1019568/'},
 {'info': '[è‹±] é˜¿Â·æŸ¯å—é“å°” / ä¸é’Ÿå ç­‰ / ç¾¤ä¼—å‡ºç‰ˆç¤¾ / 1981-8 / 53.00å…ƒ/68.00å…ƒ',
  'quote': 'åä¾¦æ¢çš„ä»£åè¯',
  'rate': '9.3',
  'title': 'ç¦å°”æ‘©æ–¯æ¢æ¡ˆå…¨é›†ï¼ˆä¸Šä¸­ä¸‹ï¼‰',
  'url': 'https://book.douban.com/subject/1040211/'},
 {'info': '[æ—¥] ä¸œé‡åœ­å¾ / åˆ˜å§¿å› / å—æµ·å‡ºç‰ˆå…¬å¸ / 2013-1-1 / 39.50å…ƒ',
  'quote': 'ä¸€å®—ç¦»å¥‡å‘½æ¡ˆç‰µå‡ºè·¨åº¦è¿‘20å¹´æ­¥æ­¥æƒŠå¿ƒçš„æ•…äº‹',
  'rate': '9.2',
  'title': 'ç™½å¤œè¡Œ',
  'url': 'https://book.douban.com/subject/10554308/'},
 {'info': '[æ³•] åœ£åŸƒå…‹è‹ä½©é‡Œ / é©¬æŒ¯éª‹ / äººæ°‘æ–‡å­¦å‡ºç‰ˆç¤¾ / 2003-8 / 22.00å…ƒ',
  'quote': 'çŒ®ç»™é•¿æˆäº†å¤§äººçš„å­©å­ä»¬',
  'rate': '9.1',
  'title': 'å°ç‹å­',
  'url': 'https://book.douban.com/subject/1084336/'},
 {'info': 'ï¼ˆä¸¹éº¦ï¼‰å®‰å¾’ç”Ÿ / å¶å›å¥ / äººæ°‘æ–‡å­¦å‡ºç‰ˆç¤¾ / 1997-08 / 25.00å…ƒ',
  'quote': 'ä¸ºäº†äº‰å–æœªæ¥çš„ä¸€ä»£',
  'rate': '9.3',
  'title': 'å®‰å¾’ç”Ÿç«¥è¯æ•…äº‹é›†',
  'url': 'https://book.douban.com/subject/1046209/'},
 {'info': 'é²è¿… / äººæ°‘æ–‡å­¦å‡ºç‰ˆç¤¾ / 1973-3 / 0.36å…ƒ',
  'quote': 'æ–°æ–‡å­¦çš„ç¬¬ä¸€å£°å‘å–Š',
  'rate': '9.2',
  'title': 'å‘å–Š',
  'url': 'https://book.douban.com/subject/1449351/'},
 {'info': 'é‡‘åº¸ / ç”Ÿæ´»Â·è¯»ä¹¦Â·æ–°çŸ¥ä¸‰è”ä¹¦åº— / 1994-5 / 96.00å…ƒ',
  'quote': 'æœ‰æƒ…çš†å­½ï¼Œæ— äººä¸å†¤',
  'rate': '9.2',
  'title': 'å¤©é¾™å…«éƒ¨',
  'url': 'https://book.douban.com/subject/1255625/'},
 {'info': 'ä¸‰æ¯› / å“ˆå°”æ»¨å‡ºç‰ˆç¤¾ / 2003-8 / 15.80å…ƒ',
  'quote': 'æ¸¸è¡çš„è‡ªç”±çµé­‚',
  'rate': '9.2',
  'title': 'æ’’å“ˆæ‹‰çš„æ•…äº‹',
  'url': 'https://book.douban.com/subject/1060068/'},

...
...
]
```

## æ€»ç»“

å†™è¿™ä¸ªçˆ¬è™«å¤§æ¦‚èŠ±äº†åŠå°æ—¶æ—¶é—´ï¼Œæ‰€ä»¥è¿™ä¸ªåº“ä¸Šæ‰‹è¿˜æ˜¯ä¸å¤ªå›°éš¾çš„ã€‚

ç„¶è€Œæœ€åŸºæœ¬çš„ä½¿ç”¨åœºæ™¯é‡Œï¼Œai å®Œå…¨æ²¡æœ‰å‡ºåœºçš„æœºä¼šã€‚

åé¢æœ‰æ—¶é—´çš„è¯ä½“éªŒå†ä½“éªŒä¸€ä¸‹å®Œå…¨ä½¿ç”¨ ai æ¥æŠ“å–ç½‘é¡µå†…å®¹çš„åŠŸèƒ½å§ã€‚

è¿™æ¬¡è¯•ç”¨æˆ‘è§‰å¾—äº®ç‚¹å¦‚ä¸‹ï¼š

- ä½¿ç”¨ playwrightï¼Œæå¤§çš„æå‡äº†çˆ¬è™«çš„å¯ç”¨æ€§å’Œä½¿ç”¨åœºæ™¯
- é»˜è®¤ä½¿ç”¨å¼‚æ­¥çš„æ–¹å¼ä½¿å¾—çˆ¬è™«çš„æ€§èƒ½éå¸¸ä¸é”™
- ç°åœ¨ä¸€äº›ç«™ç‚¹çš„å‰ç«¯é¡µé¢ä¼šåš css æ··æ·†ï¼Œä¼ ç»Ÿçš„åŸºäº css é€‰æ‹©å™¨çš„çˆ¬è™«é­é•¿è«åŠï¼Œå¼•å…¥ ai è¿›è¡Œå†…å®¹çš„çˆ¬å–éå¸¸æœ‰å¿…è¦

ä¸è¶³çš„åœ°æ–¹ï¼š

- å®˜æ–¹æ–‡æ¡£å…³äº ai ä½¿ç”¨æ–¹æ³•çš„é‚£å‡ ç¯‡ï¼Œä»£ç æ ¼å¼æ˜¯ä¹±çš„ï¼Œæå¾—æˆ‘ä¸å¥½ copyï¼Œæ‰€ä»¥ä¸‹æ¬¡å†ä½“éªŒå§
- `JsonCssExtractionStrategy`çš„ schema æ²¡æœ‰å®Œæ•´çš„è§„æ ¼è¯´æ˜ï¼Œåªèƒ½é çŒœ
- ä»£ç åº“é‡Œè·Ÿ llm ç›¸å…³çš„ä¾‹å­å¤ªå°‘
